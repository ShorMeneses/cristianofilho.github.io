!function(){var e={},t=null;function n(e){return this.enqueue=function(t,n,r){var o={data:t,config:n,resolver:r||function(){}};if(!r&&window.Promise)return new window.Promise((function(t){o.resolver=t,e.push([o.data,o.config,o.resolver])}));e.push([t,n,r])},this.sizeOf=function(){return e.length},this.consume=function(){return e.splice(0,e.length)},this}function r(e,t){if(!t)throw new Error("You must provide a queue to watch");var n=e,r=-1,o=null,i=t,s=!1;this.isWatching=!1,this.startWatching=function(e){o=e,this.processQueue(),window.clearInterval(r),this.isWatching=!0,r=window.setInterval(this.processQueue.bind(this),n)},this.stopWatching=function(){this.processQueue(),this.isWatching=!1,clearInterval(r)},this.processQueue=function(){if(!s){s=!0;var e=i.consume();o&&e.length>0&&o(e),s=!1}}}window.__lter=window.__lter||{q:[],trackEvent:function(){}},e._globalVar="__lter",e.LOCAL_STORAGE_NAME="browserId",e._retryMax=5,e.sendEvent=function(t,n,r,o){o=o||function(){};var i=!1;if(n&&!r.browserId&&(r.browserId=n),n&&navigator&&navigator.sendBeacon&&"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(t,JSON.stringify(r)))return i=!0,void setTimeout((function(){o(null,{browserId:n})}),1e3);if(!i&&window.fetch&&"CREATE"!==r.eventType)try{fetch(t,{method:"POST",mode:"cors",cache:"no-cache",keepalive:!0,headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(r)}).then((function(e){if(e.ok)return e.json();throw new Error("Response from server not ok.")})).then((function(e){o(null,e?e.data:{})})).catch((function(n){e.doTraditionalXHR(t,r,o)}))}catch(n){e.doTraditionalXHR(t,r,o)}else i||e.doTraditionalXHR(t,r,o)},e.doTraditionalXHR=function(t,n,r){var o=new window.XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=e.xhrCallback(r),o.send(JSON.stringify(n))},e.xhrCallback=function(e){return function(){if(4===this.readyState)if(this.status>=200&&this.status<400)try{var t=JSON.parse(this.response);if(200!==t.statusCode)throw new Error("Invalid response code from server");e(null,t.data)}catch(t){e(t,null)}else e(new Error("Server responded with error"),null)}},e.getCookie=function(e){if(e){var t={browserId:void 0},n=e.split(/; */);for(var r in n){var o=n[r].split("="),i=o[0],s=decodeURIComponent(o[1]);t[i]=s}return t.browserId}},e.getBackup=function(){return window.localStorage.getItem("browserId")||null},e.retryGetBrowserId=function(t,n,r){r<5?(r+=1,e.getBrowserId(t,n,r)):console.error("VanillaCEP: Unable to get browserId; skipping")},e.reportNoUrlError=function(){console.error("VanillaCEP: You must provide a URL via the data-url attribute on the script tag; skipping initialization")},e.getBrowserId=function(t,n,r){if(t){r=void 0===r?1:r;var o=e.getCookie(document.cookie)||e.getBackup();if(o)return e.storeBrowserId(o),void n(null,o);e.sendEvent(t,null,{eventType:"CREATE",context:{url:window.location.href,channel:"web",language:navigator.language}},(function(o,i){if(!o)return i&&i.browserId?(e.storeBrowserId(i.browserId),void n(null,i.browserId)):void e.retryGetBrowserId(t,n,r);e.retryGetBrowserId(t,n,r)}))}else e.reportNoUrlError()},e.storeBrowserId=function(e){document.cookie=`browserId=${e}; path=/; max-age=31536000; expires=Tue, 30 Mar 2099 03:14:07 GMT; samesite=strict;`,window.localStorage.setItem("browserId",e)},e.processItems=function(n,r){for(;n.length>0;){var o=n.shift();e.sendEvent(o[1].endpoint,t,o[0],(function(){o[2]()}))}r&&r(null,!0)},e.unmungeAnalyticsUrl=function(e){if(e){var t=e.substr(0,Math.ceil(e.length/2));return[e.substr(Math.ceil(e.length/2),e.length).split("").reverse().join(""),t].join("")}},e.getDataUrlFromDocumentElement=function(){var t=document.getElementById("__ltcep");if(t&&"script"===t.tagName.toLowerCase())return e.unmungeAnalyticsUrl(t.attributes["data-url"].value)};var o=function(e,n,r,o){window.__lter&&(window.__lter.trackEvent=n.enqueue.bind(n)),o||(o=e.getDataUrlFromDocumentElement()),n.enqueue({eventType:"PAGE.LOADED",context:{url:window.location.href,channel:"web",language:navigator.language}},{endpoint:o}),e.getBrowserId(o,(function(n,o){t=o,r.startWatching(e.processItems)}))};if("undefined"==typeof module||"object"!=typeof module.exports){var i=new n(window.__lter.q),s=new r(500,i);document.addEventListener("visibilitychange",(function(){"hidden"==document.visibilityState&&s.processQueue()})),window.addEventListener("pagehide",s.processQueue),window.addEventListener("unload",s.processQueue),o(e,i,s)}else module.exports={init:o,api:e,EventQueue:n,Watcher:r}}(window);
